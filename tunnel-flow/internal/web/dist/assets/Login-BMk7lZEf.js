import{r as v,l as I,h as Y,aB as Z,z as ee,A as h,B as s,aC as oe,R as o,J as l,al as d,a4 as le,u as n,I as L,E as R,O as u,W as te,P as B,n as se}from"./vendor-CVfcT1hl.js";import{t as ae,x as ne,m as A,s as E,b as N,n as re,u as ie,y as de,E as p}from"./elementPlus-DsCZj5OD.js";import{r as ue,u as me}from"./index-CCZm0Y1N.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe=U=>ue.post("/auth/login",U),ge={class:"login-page"},ce={class:"theme-toggle-container"},ve={class:"login-container"},_e={class:"login-header"},we={class:"logo"},ye={class:"login-card-wrapper"},be={class:"login-card-glass"},ke={class:"login-options"},Ve={class:"login-footer"},xe={class:"social-login"},he={class:"qr-login-content"},Ce={class:"qr-code"},Se={class:"sms-container"},Fe={__name:"Login",setup(U){const C=Z(),_=me(),M=a=>{_.setTheme(a)},x=v(!1),y=v(!1),S=v(!1),b=v(!1),z=v(""),w=v(0),F=v(),m=I({username:"",password:"",remember:!1}),k=I({email:""}),f=I({phone:"",code:""}),Q={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}]},$=async()=>{var a,e;if(console.log("handleLogin called"),!F.value){console.log("loginFormRef is null");return}try{console.log("Starting form validation");const i=await F.value.validate();if(console.log("Form validation result:",i),!i){console.log("Form validation failed");return}x.value=!0,console.log("Calling login API with:",{username:m.username,password:m.password});const r=await fe({username:m.username,password:m.password});console.log("Login API response:",r),p.success("登录成功");const g=r.data.data||r.data;console.log("Saving login data:",g),localStorage.setItem("token",g.token),localStorage.setItem("user",JSON.stringify(g.user)),await se(),C.push("/")}catch(i){console.error("Login error:",i),console.error("Error response:",i.response),p.error("登录失败: "+(((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||i.message))}finally{x.value=!1}},D=async()=>{if(!k.email){p.warning("请输入邮箱地址");return}try{await new Promise(a=>setTimeout(a,1e3)),p.success("重置邮件已发送，请查收"),y.value=!1,k.email=""}catch(a){p.error("发送失败: "+a.message)}},J=async()=>{if(!f.phone||!f.code){p.warning("请输入手机号和验证码");return}try{await new Promise(a=>setTimeout(a,1e3)),p.success("登录成功"),b.value=!1,C.push("/")}catch(a){p.error("登录失败: "+a.message)}},q=()=>{z.value=`data:image/svg+xml;base64,${btoa(`
    <svg width="200" height="200" xmlns="http://www.w3.org/2000/svg">
      <rect width="200" height="200" fill="white"/>
      <rect x="20" y="20" width="160" height="160" fill="none" stroke="#333" stroke-width="2"/>
      <text x="100" y="110" text-anchor="middle" font-family="Arial" font-size="14" fill="#666">
        QR Code
      </text>
    </svg>
  `)}`},K=async()=>{if(!f.phone){p.warning("请输入手机号");return}try{await new Promise(e=>setTimeout(e,1e3)),p.success("验证码已发送"),w.value=60;const a=setInterval(()=>{w.value--,w.value<=0&&clearInterval(a)},1e3)}catch(a){p.error("发送失败: "+a.message)}};return Y(()=>{localStorage.getItem("token")&&C.push("/"),q()}),(a,e)=>{const i=d("el-icon"),r=d("el-button"),g=d("el-dropdown-item"),O=d("el-dropdown-menu"),H=d("el-dropdown"),V=d("el-input"),c=d("el-form-item"),W=d("el-checkbox"),j=d("el-link"),T=d("el-form"),G=d("el-divider"),P=d("el-dialog"),X=d("el-image");return h(),ee("div",ge,[s("div",ce,[o(H,{class:"theme-dropdown",onCommand:M},{dropdown:l(()=>[o(O,null,{default:l(()=>[o(g,{command:"light",class:R({"is-active":n(_).theme==="light"})},{default:l(()=>[o(i,null,{default:l(()=>[o(n(E))]),_:1}),e[14]||(e[14]=u(" 明亮模式 ",-1))]),_:1},8,["class"]),o(g,{command:"dark",class:R({"is-active":n(_).theme==="dark"})},{default:l(()=>[o(i,null,{default:l(()=>[o(n(N))]),_:1}),e[15]||(e[15]=u(" 黑暗模式 ",-1))]),_:1},8,["class"]),o(g,{command:"system",class:R({"is-active":n(_).theme==="system"})},{default:l(()=>[o(i,null,{default:l(()=>[o(n(A))]),_:1}),e[16]||(e[16]=u(" 跟随系统 ",-1))]),_:1},8,["class"])]),_:1})]),default:l(()=>[o(r,{type:"text",class:"theme-toggle-btn",size:"large"},{default:l(()=>[o(i,null,{default:l(()=>[n(_).theme==="system"?(h(),L(n(A),{key:0})):n(_).actualTheme==="light"?(h(),L(n(E),{key:1})):(h(),L(n(N),{key:2}))]),_:1})]),_:1})]),_:1})]),s("div",ve,[s("div",_e,[s("div",we,[o(i,{size:"48"},{default:l(()=>[o(n(re))]),_:1})]),e[17]||(e[17]=s("h1",null,"Tunnel Flow",-1)),e[18]||(e[18]=s("p",null,"HTTP隧道透传代理平台",-1))]),s("div",ye,[s("div",be,[e[22]||(e[22]=s("div",{class:"card-header"},[s("span",null,"用户登录")],-1)),o(T,{ref_key:"loginFormRef",ref:F,model:m,rules:Q,size:"large",onKeyup:le($,["enter"])},{default:l(()=>[o(c,{prop:"username"},{default:l(()=>[o(V,{modelValue:m.username,"onUpdate:modelValue":e[0]||(e[0]=t=>m.username=t),placeholder:"请输入用户名","prefix-icon":n(ie),clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),o(c,{prop:"password"},{default:l(()=>[o(V,{modelValue:m.password,"onUpdate:modelValue":e[1]||(e[1]=t=>m.password=t),type:"password",placeholder:"请输入密码","prefix-icon":n(de),"show-password":"",clearable:""},null,8,["modelValue","prefix-icon"])]),_:1}),o(c,null,{default:l(()=>[s("div",ke,[o(W,{modelValue:m.remember,"onUpdate:modelValue":e[2]||(e[2]=t=>m.remember=t)},{default:l(()=>[...e[19]||(e[19]=[u("记住密码",-1)])]),_:1},8,["modelValue"]),o(j,{type:"primary",onClick:e[3]||(e[3]=t=>y.value=!0)},{default:l(()=>[...e[20]||(e[20]=[u("忘记密码？",-1)])]),_:1})])]),_:1}),o(c,null,{default:l(()=>[o(r,{type:"primary",size:"large",style:{width:"100%"},loading:x.value,onClick:te($,["prevent"]),"native-type":"submit"},{default:l(()=>[u(B(x.value?"登录中...":"登录"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),s("div",Ve,[o(G,null,{default:l(()=>[...e[21]||(e[21]=[u("其他登录方式",-1)])]),_:1}),s("div",xe,[o(r,{circle:"",icon:n(ae),onClick:e[4]||(e[4]=t=>S.value=!0)},null,8,["icon"]),o(r,{circle:"",icon:n(ne),onClick:e[5]||(e[5]=t=>b.value=!0)},null,8,["icon"])])])])]),e[23]||(e[23]=s("div",{class:"login-info"},[s("p",null,"© 2025 Tunnel Flow. All rights reserved."),s("p",null,"Version 1.0.0")],-1))]),e[30]||(e[30]=oe('<div class="background-decoration" data-v-764fab2a><div class="decoration-item item-1" data-v-764fab2a></div><div class="decoration-item item-2" data-v-764fab2a></div><div class="decoration-item item-3" data-v-764fab2a></div><div class="decoration-item item-4" data-v-764fab2a></div><div class="decoration-item item-5" data-v-764fab2a></div></div>',1)),o(P,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=t=>y.value=t),title:"找回密码",width:"400px"},{footer:l(()=>[o(r,{onClick:e[7]||(e[7]=t=>y.value=!1)},{default:l(()=>[...e[24]||(e[24]=[u("取消",-1)])]),_:1}),o(r,{type:"primary",onClick:D},{default:l(()=>[...e[25]||(e[25]=[u("发送重置邮件",-1)])]),_:1})]),default:l(()=>[o(T,{model:k,"label-width":"80px"},{default:l(()=>[o(c,{label:"邮箱"},{default:l(()=>[o(V,{modelValue:k.email,"onUpdate:modelValue":e[6]||(e[6]=t=>k.email=t),placeholder:"请输入注册邮箱"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(P,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=t=>S.value=t),title:"扫码登录",width:"300px","align-center":""},{default:l(()=>[s("div",he,[s("div",Ce,[o(X,{src:z.value,alt:"登录二维码",style:{width:"200px",height:"200px"}},null,8,["src"])]),e[27]||(e[27]=s("p",null,"请使用手机扫描二维码登录",-1)),o(r,{onClick:q},{default:l(()=>[...e[26]||(e[26]=[u("刷新二维码",-1)])]),_:1})])]),_:1},8,["modelValue"]),o(P,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=t=>b.value=t),title:"手机登录",width:"400px"},{footer:l(()=>[o(r,{onClick:e[12]||(e[12]=t=>b.value=!1)},{default:l(()=>[...e[28]||(e[28]=[u("取消",-1)])]),_:1}),o(r,{type:"primary",onClick:J},{default:l(()=>[...e[29]||(e[29]=[u("登录",-1)])]),_:1})]),default:l(()=>[o(T,{model:f,"label-width":"80px"},{default:l(()=>[o(c,{label:"手机号"},{default:l(()=>[o(V,{modelValue:f.phone,"onUpdate:modelValue":e[10]||(e[10]=t=>f.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),o(c,{label:"验证码"},{default:l(()=>[s("div",Se,[o(V,{modelValue:f.code,"onUpdate:modelValue":e[11]||(e[11]=t=>f.code=t),placeholder:"请输入验证码",style:{flex:"1"}},null,8,["modelValue"]),o(r,{disabled:w.value>0,onClick:K},{default:l(()=>[u(B(w.value>0?`${w.value}s`:"发送验证码"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Re=pe(Fe,[["__scopeId","data-v-764fab2a"]]);export{Re as default};

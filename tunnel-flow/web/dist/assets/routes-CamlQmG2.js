import{az as x,r as p,c as f}from"./vendor-CVfcT1hl.js";import{a as v,r as g}from"./index-DdU4QHiA.js";const q=x("clients",()=>{const n=p([]),c=p([]),u=p(!1),l=p(null),i=p({page:1,pageSize:20,total:0}),w=f(()=>c.value.filter(e=>e.status==="online")),S=f(()=>c.value.filter(e=>e.status==="offline")),C=f(()=>c.value.filter(e=>e.enabled===0)),h=f(()=>c.value.filter(e=>e.enabled===1)),F=f(()=>({total:c.value.length,online:w.value.length,offline:S.value.length,disabled:C.value.length,enabled:h.value.length})),y=async(e={})=>{try{u.value=!0,l.value=null;const a={page:i.value.page,page_size:i.value.pageSize,...e},s=await v.get("/clients",{params:a});Array.isArray(s.data)?(n.value=s.data,e.status||(c.value=s.data),i.value.total=s.data.length):s.data&&s.data.clients?(n.value=s.data.clients,e.status||(c.value=s.data.clients),i.value.total=s.data.total||s.data.clients.length):(n.value=[],i.value.total=0)}catch(a){l.value=a.message||"获取客户端列表失败",console.error("Failed to fetch clients:",a)}finally{u.value=!1}},R=async()=>{try{const e=await v.get("/clients");Array.isArray(e.data)?c.value=e.data:e.data&&e.data.clients?c.value=e.data.clients:c.value=[]}catch(e){console.error("Failed to fetch all clients for stats:",e)}};return{clients:n,allClients:c,loading:u,error:l,pagination:i,onlineClients:w,offlineClients:S,disabledClients:C,enabledClients:h,clientsStats:F,fetchClients:y,fetchAllClients:R,fetchClientsByStatus:async(e="")=>{c.value.length===0&&await R();const a={};e&&(a.status=e),await y(a)},getClientById:async e=>{try{return(await v.get(`/clients/${e}`)).data}catch(a){throw l.value=a.message||"获取客户端详情失败",console.error("Failed to get client:",a),a}},createClient:async e=>{try{const a=await v.post("/clients",e);return n.value.unshift(a.data),i.value.total++,a.data}catch(a){throw l.value=a.message||"创建客户端失败",console.error("Failed to create client:",a),a}},updateClient:async(e,a)=>{try{const s=await v.put(`/clients/${e}`,a),d=n.value.findIndex(m=>m.client_id===e);return d!==-1&&(n.value[d]={...n.value[d],...s.data}),s.data}catch(s){throw l.value=s.message||"更新客户端失败",console.error("Failed to update client:",s),s}},deleteClient:async e=>{try{await v.delete(`/clients/${e}`);const a=n.value.findIndex(s=>s.client_id===e);a!==-1&&(n.value.splice(a,1),i.value.total--)}catch(a){throw l.value=a.message||"删除客户端失败",console.error("Failed to delete client:",a),a}},updateClientStatus:async(e,a)=>{try{const s=await v.put(`/clients/${e}/status`,{status:a}),d=n.value.findIndex(m=>m.client_id===e);return d!==-1&&(n.value[d].status=a,n.value[d].updated_at=new Date().toISOString()),s.data}catch(s){throw l.value=s.message||"更新客户端状态失败",console.error("Failed to update client status:",s),s}},updateClientEnabled:async(e,a)=>{try{const s=await v.put(`/clients/${e}/enabled`,{enabled:a}),d=n.value.findIndex(m=>m.client_id===e);return d!==-1&&(n.value[d].enabled=a,n.value[d].updated_at=new Date().toISOString()),s.data}catch(s){throw l.value=s.message||"更新客户端启用状态失败",console.error("Failed to update client enabled status:",s),s}},sendMessageToClient:async(e,a)=>{try{return(await v.post(`/clients/${e}/message`,{type:"control",payload:a})).data}catch(s){throw l.value=s.message||"发送消息失败",console.error("Failed to send message to client:",s),s}},refreshClients:()=>y(),setPage:e=>(i.value.page=e,y()),setPageSize:e=>(i.value.pageSize=e,i.value.page=1,y()),clearError:()=>{l.value=null}}}),M=x("routes",()=>{const n=p([]),c=p(!1),u=p(null),l=p({page:1,pageSize:20,total:0}),i=f(()=>n.value.filter(r=>r.status==="active")),w=f(()=>n.value.filter(r=>r.status==="inactive")),S=f(()=>({total:n.value.length,active:i.value.length,inactive:w.value.length})),C=f(()=>{const r={};return n.value.forEach(t=>{r[t.client_id]||(r[t.client_id]=[]),r[t.client_id].push(t)}),r}),h=async(r={})=>{var t,o;try{c.value=!0,u.value=null;const e={page:l.value.page,page_size:l.value.pageSize,...r},a=await g.get("/routes",{params:e});n.value=((t=a.data)==null?void 0:t.routes)||[],l.value.total=((o=a.data)==null?void 0:o.total)||0}catch(e){u.value=e.message||"获取路由列表失败",console.error("Failed to fetch routes:",e)}finally{c.value=!1}};return{routes:n,loading:c,error:u,pagination:l,activeRoutes:i,inactiveRoutes:w,routesStats:S,routesByClient:C,fetchRoutes:h,getRouteById:async r=>{try{return(await g.get(`/routes/${r}`)).data}catch(t){throw u.value=t.message||"获取路由详情失败",console.error("Failed to get route:",t),t}},createRoute:async r=>{try{const t=await g.post("/routes",r);return n.value.unshift(t.data),l.value.total++,t.data}catch(t){throw u.value=t.message||"创建路由失败",console.error("Failed to create route:",t),t}},updateRoute:async(r,t)=>{try{const o=await g.put(`/routes/${r}`,t),e=n.value.findIndex(a=>a.id===r);return e!==-1&&(n.value[e]={...n.value[e],...o.data}),o.data}catch(o){throw u.value=o.message||"更新路由失败",console.error("Failed to update route:",o),o}},deleteRoute:async r=>{try{await g.delete(`/routes/${r}`);const t=n.value.findIndex(o=>o.id===r);t!==-1&&(n.value.splice(t,1),l.value.total--)}catch(t){throw u.value=t.message||"删除路由失败",console.error("Failed to delete route:",t),t}},activateRoute:async r=>{try{await g.post(`/routes/${r}/activate`);const t=n.value.findIndex(o=>o.id===r);t!==-1&&(n.value[t].status="active",n.value[t].updated_at=new Date().toISOString())}catch(t){throw u.value=t.message||"激活路由失败",console.error("Failed to activate route:",t),t}},deactivateRoute:async r=>{try{await g.post(`/routes/${r}/deactivate`);const t=n.value.findIndex(o=>o.id===r);t!==-1&&(n.value[t].status="inactive",n.value[t].updated_at=new Date().toISOString())}catch(t){throw u.value=t.message||"停用路由失败",console.error("Failed to deactivate route:",t),t}},testRoute:async r=>{try{return(await g.post(`/routes/${r}/test`)).data}catch(t){throw u.value=t.message||"测试路由失败",console.error("Failed to test route:",t),t}},getRouteStats:async(r,t="24h")=>{try{return(await g.get(`/routes/${r}/stats`,{params:{time_range:t}})).data}catch(o){throw u.value=o.message||"获取路由统计失败",console.error("Failed to get route stats:",o),o}},refreshRoutes:()=>h(),setPage:r=>(l.value.page=r,h()),setPageSize:r=>(l.value.pageSize=r,l.value.page=1,h()),clearError:()=>{u.value=null}}});export{M as a,q as u};
